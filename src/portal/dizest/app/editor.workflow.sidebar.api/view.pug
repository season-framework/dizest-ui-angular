div(class="w-[420px] flex flex-col h-full bg-white relative")
    div(class="flex w-full items-center bg-indigo-500 text-white px-3 py-2 draggable-handle")
        div(class="flex flex-1 gap-x-2 items-center")
            i.fa-solid.fa-link
            span External API
        div((click)="sidebar.close()", class="cursor-pointer")
            i.fa-solid.fa-xmark
    
    div(class="flex-1 w-full h-full overflow-hidden")
        div(class="w-full h-full overflow-hidden overflow-y-auto")
            div(class="text-lg font-bold px-3 py-2") Basic information
            table(class="w-full divide-y divide-gray-300 border-b border-gray-300")
                thead(class="bg-gray-50")
                    tr
                        th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Mode
                        th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") URL
                tbody(class="divide-y divide-gray-200 bg-white")
                    tr(class="cursor-pointer hover:bg-indigo-200", (click)="changeMode('run')", [class.bg-indigo-100]="mode == 'run'")
                        td(class="whitespace-nowrap px-3 py-2 text-sm text-gray-500") Batch
                        td(class="break-all whitespace-break-spaces px-3 py-2 text-sm text-gray-500") {{BASEURL}}/dizest/api/run/{{PATH}}
                    tr(class="cursor-pointer hover:bg-indigo-200", (click)="changeMode('stream')", [class.bg-indigo-100]="mode == 'stream'")
                        td(class="whitespace-nowrap px-3 py-2 text-sm text-gray-500") Stream
                        td(class="break-all whitespace-break-spaces px-3 py-2 text-sm text-gray-500") {{BASEURL}}/dizest/api/stream/{{PATH}}

            ng-container
                div(class="mt-4 text-lg font-bold px-3 py-2") Request Header
                table(class="w-full divide-y divide-gray-300 border-b border-gray-300")
                    thead(class="bg-gray-50")
                        tr
                            th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Name
                            th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Description
                    tbody(class="divide-y divide-gray-200 bg-white")
                        tr
                            td(class="whitespace-nowrap px-3 py-2 text-sm text-gray-500") Authorization
                            td(class="break-all whitespace-break-spaces px-3 py-2 text-sm text-gray-500")
                                | Authorization: Bearer {{app.dizest.config.external_api_key ? app.dizest.config.external_api_key : '${Set API Key in Setting}'}}

            ng-container(*ngIf="inputs.length > 0")
                div(class="mt-4 text-lg font-bold px-3 py-2") Query parameter
                table(class="w-full divide-y divide-gray-300 border-b border-gray-300")
                    thead(class="bg-gray-50")
                        tr
                            th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Name
                            th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Flow
                            th(scope="col", class="px-3 py-3 text-left text-sm font-semibold text-gray-900") Value
                    tbody(class="divide-y divide-gray-200 bg-white")
                        tr(*ngFor="let item of inputs")
                            td(class="break-all whitespace-break-spaces px-3 py-2 text-sm text-gray-500") {{item.name}}
                            td(class="break-all whitespace-break-spaces px-3 py-2 text-sm text-gray-500")
                                ul.m-0.p-0
                                    li(class="cursor-pointer hover:bg-gray-100", *ngFor="let flow_id of item.flow", (click)="clickFlow(flow_id)") {{app.workflow.spec.flow(flow_id).title()}}
                            td(class="w-[16aa0px] whitespace-nowrap px-3 py-2 text-sm text-gray-500")
                                div(class="w-full flex rounded-md shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-600")
                                    input(
                                        type="text", 
                                        [(ngModel)]="values[item.name]",
                                        class="block w-full flex-1 border-0 bg-transparent py-1.5 px-3 text-gray-900 placeholder:text-gray-400 focus:ring-0 text-sm leading-6")
                
            div(class="mt-4 text-lg font-bold px-3 py-2") cURL Command

            div(class="px-3 py-2 break-all whitespace-break-spaces")
                | curl -H "Authorization: Bearer {{app.dizest.config.external_api_key}}" -d "{{valueString()}}" {{BASEURL}}/dizest/api/{{mode}}/{{PATH}}

            div(class="mt-2 px-3 py-2")
                button(
                    class="flex items-center justify-center px-4 py-1 w-full text-sm bg-indigo-500 text-white cursor-pointer rounded-full hover:bg-indigo-700",
                    (click)="testAPI()") 
                    span(*ngIf="!running") Test
                    svg(class="animate-spin h-[20px] w-[20px]", viewBox="0 0 24 24", *ngIf="running")
                        circle(class="opacity-25", cx="12", cy="12", r="10", stroke="currentColor", stroke-width="4")
                        path(class="opacity-75", fill="currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z")

            ng-container(*ngIf="response")
                div(class="mt-4 text-lg font-bold px-3 py-2") Response                    
                div(class="mt-2 px-3 py-2 bg-slate-100 whitespace-pre overflow-auto")
                    | {{response}}
